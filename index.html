```html
<!DOCTYPE html>
<html lang="tr" data-theme="light">
<head>
    <!-- Meta Tags - SEO Optimization -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- SEO Meta Tags -->
    <title>Testify - Yapay Zeka Destekli AkÄ±llÄ± EÄŸitim Platformu | Online Test Ã‡Ã¶zme</title>
    <meta name="description" content="Testify ile yapay zeka destekli test Ã§Ã¶zÃ¼n, performansÄ±nÄ±zÄ± analiz edin ve sÄ±nava hazÄ±rlanÄ±n. Ãœcretsiz online test platformu.">
    <meta name="keywords" content="online test, sÄ±nav hazÄ±rlÄ±k, yapay zeka test, eÄŸitim platformu, test Ã§Ã¶zme, YKS, LGS, KPSS">
    <meta name="author" content="Testify Team">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://testify.com">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://testify.com">
    <meta property="og:title" content="Testify - AkÄ±llÄ± EÄŸitim Platformu">
    <meta property="og:description" content="Yapay zeka destekli test Ã§Ã¶zme platformu. PerformansÄ±nÄ± analiz et, hedefine ulaÅŸ!">
    <meta property="og:image" content="https://testify.com/og-image.jpg">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://testify.com">
    <meta property="twitter:title" content="Testify - AkÄ±llÄ± EÄŸitim Platformu">
    <meta property="twitter:description" content="Yapay zeka destekli test Ã§Ã¶zme platformu">
    <meta property="twitter:image" content="https://testify.com/twitter-image.jpg">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    
    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://pagead2.googlesyndication.com">
    
    <!-- Font - Preload for Performance -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" as="style">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1234567890123456" crossorigin="anonymous"></script>
    
    <!-- External CSS -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Schema.org Markup -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "EducationalOrganization",
      "name": "Testify",
      "description": "Yapay zeka destekli online test ve eÄŸitim platformu",
      "url": "https://testify.com"
    }
    </script>

    <!-- Floating Testfy Assistant Styles -->
    <style>
        .chat-widget-wrapper{
            position:fixed;
            right:1.5rem;
            bottom:1.5rem;
            z-index:999;
            display:flex;
            flex-direction:column;
            align-items:flex-end;
            gap:0.75rem;
        }
        .chat-toggle-btn{
            display:flex;
            align-items:center;
            gap:0.5rem;
            border:none;
            border-radius:999px;
            padding:0.55rem 1.1rem;
            font-family:inherit;
            font-size:0.95rem;
            font-weight:600;
            background:var(--primary,#4f46e5);
            color:#fff;
            box-shadow:0 10px 25px rgba(15,23,42,0.35);
            cursor:pointer;
            transition:transform .16s ease,box-shadow .16s ease,opacity .16s ease;
        }
        .chat-toggle-btn:hover{
            transform:translateY(-1px);
            box-shadow:0 12px 30px rgba(15,23,42,0.4);
        }
        .chat-toggle-btn:focus-visible{
            outline:2px solid var(--primary,#4f46e5);
            outline-offset:2px;
        }
        .chat-toggle-btn--hidden{
            display:none;
        }
        .chat-toggle-initial{
            width:2rem;
            height:2rem;
            border-radius:999px;
            display:flex;
            align-items:center;
            justify-content:center;
            font-weight:700;
            background:rgba(15,23,42,0.15);
        }
        .chat-toggle-text{
            letter-spacing:0.02em;
        }
        .chat-widget{
            position:fixed;
            right:1.5rem;
            bottom:5rem;
            width:360px;
            max-width:calc(100vw - 2rem);
            max-height:70vh;
            display:flex;
            flex-direction:column;
            background:var(--bg-primary,#0f172a);
            color:var(--text-primary,#e5e7eb);
            border-radius:1rem;
            box-shadow:0 18px 45px rgba(15,23,42,0.55);
            border:1px solid rgba(148,163,184,0.6);
            overflow:hidden;
            opacity:0;
            pointer-events:none;
            transform:translateY(12px) scale(0.98);
            transition:opacity .18s ease,transform .18s ease;
        }
        .chat-widget--open{
            opacity:1;
            pointer-events:auto;
            transform:translateY(0) scale(1);
        }
        .chat-widget--minimized .chat-body,
        .chat-widget--minimized .chat-footer{
            display:none;
        }
        .chat-header{
            padding:0.85rem 1rem;
            display:flex;
            align-items:center;
            justify-content:space-between;
            background:linear-gradient(135deg,rgba(15,23,42,0.98),rgba(30,64,175,0.95));
            color:#f9fafb;
        }
        .chat-title{
            display:flex;
            flex-direction:column;
            gap:0.15rem;
        }
        .chat-title-main{
            font-weight:600;
            font-size:0.95rem;
        }
        .chat-status{
            display:flex;
            align-items:center;
            gap:0.35rem;
            font-size:0.78rem;
            opacity:0.9;
        }
        .chat-header-actions{
            display:flex;
            align-items:center;
            gap:0.25rem;
        }
        .chat-header-btn{
            width:1.9rem;
            height:1.9rem;
            border-radius:999px;
            border:none;
            background:rgba(15,23,42,0.25);
            color:inherit;
            display:flex;
            align-items:center;
            justify-content:center;
            font-size:0.9rem;
            cursor:pointer;
        }
        .chat-header-btn:hover{
            background:rgba(15,23,42,0.4);
        }
        .chat-body{
            padding:0.75rem 0.9rem;
            background:var(--bg-secondary,#020617);
        }
        .chat-footer{
            padding:0.7rem 0.9rem 0.8rem;
            background:var(--bg-secondary,#020617);
            border-top:1px solid rgba(15,23,42,0.7);
        }
        .chat-footer .ai-input-group{
            background:var(--bg-tertiary,rgba(15,23,42,0.9));
        }
        .ai-chat{
            max-height:40vh;
        }
        @media (max-width:768px){
            .chat-widget-wrapper{
                right:1rem;
                bottom:1rem;
            }
            .chat-widget{
                right:0.5rem;
                left:0.5rem;
                bottom:0.75rem;
                width:auto;
                max-width:none;
                max-height:80vh;
                border-radius:1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Skip to Main Content (Accessibility) -->
    <a href="#main-content" class="skip-link">Ana iÃ§eriÄŸe geÃ§</a>

    <!-- Header -->
    <header class="header" role="banner">
        <div class="header-content">
            <div class="header-top">
                <a href="/" class="logo" aria-label="Testify Ana Sayfa">
                    <span role="img" aria-label="EÄŸitim ikonu">ğŸ“</span>
                    <span data-i18n="app.name">Testify</span>
                </a>
                
                <div class="header-actions">
                    <!-- Language Selector - Otomatik oluÅŸturulacak -->
                    
                    <!-- Theme Toggle -->
                    <button 
                        class="theme-toggle" 
                        onclick="themeManager.toggle()"
                        aria-label="Tema deÄŸiÅŸtir"
                        aria-pressed="false"
                        title="KaranlÄ±k/AydÄ±nlÄ±k mod">
                        <span class="theme-toggle-slider">
                            <span id="themeIcon" aria-hidden="true">â˜€ï¸</span>
                        </span>
                    </button>
                    
                    <div class="user-stats" role="status" aria-live="polite">
                        <div class="stat-badge" title="GÃ¼nlÃ¼k seri">
                            <span role="img" aria-label="AteÅŸ ikonu">ğŸ”¥</span>
                            <span id="streak" aria-label="Seri gÃ¼nler">0 <span data-i18n="header.streak">GÃ¼n</span></span>
                        </div>
                        <div class="stat-badge" title="Toplam puan">
                            <span role="img" aria-label="YÄ±ldÄ±z ikonu">â­</span>
                            <span id="totalPoints" aria-label="Toplam XP">0 <span data-i18n="header.points">XP</span></span>
                        </div>
                        <div class="stat-badge" title="SÄ±ralama">
                            <span role="img" aria-label="Kupa ikonu">ğŸ†</span>
                            <span id="rank" aria-label="SÄ±ralama">#--</span>
                        </div>
                    </div>
                    <button class="user-avatar" id="userAvatar" aria-label="KullanÄ±cÄ± menÃ¼sÃ¼" title="Profil">U</button>
                </div>
            </div>
            
            <!-- Navigation Tabs -->
            <nav class="nav-tabs" role="navigation" aria-label="Ana navigasyon">
                <button class="nav-tab active" data-tab="dashboard" role="tab" aria-selected="true" aria-controls="dashboard">
                    <span role="img" aria-hidden="true">ğŸ“Š</span> <span data-i18n="nav.dashboard">Dashboard</span>
                </button>
                <button class="nav-tab" data-tab="test" role="tab" aria-selected="false" aria-controls="test">
                    <span role="img" aria-hidden="true">ğŸ“</span> <span data-i18n="nav.test">Test Ã‡Ã¶z</span>
                </button>
                <button class="nav-tab" data-tab="create" role="tab" aria-selected="false" aria-controls="create">
                    <span role="img" aria-hidden="true">â•</span> <span data-i18n="nav.create">Test OluÅŸtur</span>
                </button>
                <button class="nav-tab" data-tab="library" role="tab" aria-selected="false" aria-controls="library">
                    <span role="img" aria-hidden="true">ğŸ“š</span> <span data-i18n="nav.library">KÃ¼tÃ¼phanem</span>
                </button>
                <button class="nav-tab" data-tab="notes" role="tab" aria-selected="false" aria-controls="notes">
                    <span role="img" aria-hidden="true">ğŸ“</span> <span data-i18n="nav.notes">NotlarÄ±m</span>
                </button>
                <button class="nav-tab" data-tab="leaderboard" role="tab" aria-selected="false" aria-controls="leaderboard">
                    <span role="img" aria-hidden="true">ğŸ†</span> <span data-i18n="nav.leaderboard">Liderlik</span>
                </button>
                <button class="nav-tab" data-tab="analysis" role="tab" aria-selected="false" aria-controls="analysis">
                    <span role="img" aria-hidden="true">ğŸ“ˆ</span> <span data-i18n="nav.analysis">Analizler</span>
                </button>
                <button class="nav-tab" data-tab="settings" role="tab" aria-selected="false" aria-controls="settings">
                    <span role="img" aria-hidden="true">âš™ï¸</span> <span data-i18n="nav.settings">Ayarlar</span>
                </button>
            </nav>
        </div>
    </header>

    <!-- Top Ad Banner -->
    <aside class="ad-banner" aria-label="Reklam" role="complementary">
        <div id="ad-top" class="ad-container">
            <span>ğŸ“¢ Reklam AlanÄ± (728x90)</span>
        </div>
    </aside>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Main Content Area -->
        <main class="main-content" id="main-content" role="main">
            <!-- Dashboard Tab -->
            <section class="tab-content active" id="dashboard" role="tabpanel" aria-labelledby="tab-dashboard">
                <h1 data-i18n="dashboard.title">Dashboard</h1>
                
                <div class="stats-grid" role="region" aria-label="Ä°statistikler">
                    <article class="stat-card">
                        <div class="stat-icon" aria-hidden="true">ğŸ“</div>
                        <div class="stat-value" id="totalTests" aria-label="Ã‡Ã¶zÃ¼len test sayÄ±sÄ±">0</div>
                        <div class="stat-label" data-i18n="dashboard.tests">Ã‡Ã¶zÃ¼len Test</div>
                    </article>
                    <article class="stat-card">
                        <div class="stat-icon" aria-hidden="true">âœ…</div>
                        <div class="stat-value" id="successRate" aria-label="BaÅŸarÄ± oranÄ±">0%</div>
                        <div class="stat-label" data-i18n="dashboard.success">BaÅŸarÄ± OranÄ±</div>
                    </article>
                    <article class="stat-card">
                        <div class="stat-icon" aria-hidden="true">ğŸ¯</div>
                        <div class="stat-value" id="totalQuestions" aria-label="Toplam soru sayÄ±sÄ±">0</div>
                        <div class="stat-label" data-i18n="dashboard.questions">Toplam Soru</div>
                    </article>
                    <article class="stat-card">
                        <div class="stat-icon" aria-hidden="true">â±ï¸</div>
                        <div class="stat-value" id="avgTime" aria-label="Ortalama sÃ¼re">0s</div>
                        <div class="stat-label" data-i18n="dashboard.avgTime">Ort. SÃ¼re</div>
                    </article>
                </div>

                <!-- Recent Activity -->
                <section class="recent-activity" aria-labelledby="recent-activity-title">
                    <h2 id="recent-activity-title" data-i18n="dashboard.activity">Son Aktiviteler</h2>
                    <div id="activityList" class="activity-list">
                        <div class="empty-state">
                            <div class="empty-state-icon" aria-hidden="true">ğŸ“Š</div>
                            <p data-i18n="dashboard.empty">HenÃ¼z aktivite yok. Test Ã§Ã¶zerek baÅŸla!</p>
                        </div>
                    </div>
                </section>

                <!-- Side Ad -->
                <aside class="ad-banner" aria-label="Reklam">
                    <div id="ad-dashboard" class="ad-container">
                        <span>ğŸ“¢ Reklam AlanÄ± (300x250)</span>
                    </div>
                </aside>
            </section>

            <!-- Test Tab -->
            <section class="tab-content" id="test" role="tabpanel" aria-labelledby="tab-test">
                <!-- Test Selection Page -->
                <div class="test-page active" id="testSelection">
                    <div class="test-selection">
                        <h1 data-i18n="test.title">Test SeÃ§</h1>
                        <div class="test-options" role="group" aria-label="Test modu seÃ§enekleri">
                            <article class="test-option-card" tabindex="0" role="button" aria-label="Pratik modu">
                                <div class="test-option-icon" aria-hidden="true">ğŸ“–</div>
                                <h3 class="test-option-title" data-i18n="test.practice">Pratik Modu</h3>
                                <p class="test-option-desc" data-i18n="test.practiceDesc">Zaman baskÄ±sÄ± olmadan pratik yap</p>
                            </article>
                            <article class="test-option-card" tabindex="0" role="button" aria-label="SÄ±nav modu">
                                <div class="test-option-icon" aria-hidden="true">â±ï¸</div>
                                <h3 class="test-option-title" data-i18n="test.exam">SÄ±nav Modu</h3>
                                <p class="test-option-desc" data-i18n="test.examDesc">GerÃ§ek sÄ±nav deneyimi</p>
                            </article>
                            <article class="test-option-card" tabindex="0" role="button" aria-label="AI test">
                                <div class="test-option-icon" aria-hidden="true">ğŸ¤–</div>
                                <h3 class="test-option-title" data-i18n="test.ai">AI Test</h3>
                                <p class="test-option-desc" data-i18n="test.aiDesc">AI tarafÄ±ndan oluÅŸturulan sorular</p>
                            </article>
                            <article class="test-option-card" tabindex="0" role="button" aria-label="Ã–zel test">
                                <div class="test-option-icon" aria-hidden="true">âš™ï¸</div>
                                <h3 class="test-option-title" data-i18n="test.custom">Ã–zel Test</h3>
                                <p class="test-option-desc" data-i18n="test.customDesc">Kendi kriterlerine gÃ¶re</p>
                            </article>
                        </div>
                    </div>
                </div>

                <!-- Quiz Page -->
                <div class="test-page" id="quizPage" aria-live="polite">
                    <div class="quiz-container">
                        <!-- HEADER - EXIT BUTONU Ä°LE -->
                        <div class="quiz-header">
                            <div class="quiz-info">
                                <span><span data-i18n="quiz.question">Soru</span> <span id="currentQuestion">1</span> <span data-i18n="quiz.of">/</span> <span id="totalQuestionsQuiz">10</span></span>
                            </div>
                            <div class="quiz-info">
                                <span role="img" aria-label="SÃ¼re">â±ï¸</span> 
                                <time id="quizTimer">00:00</time>
                            </div>
                            <!-- EXIT BUTTON -->
                            <button 
                                class="btn-exit-quiz" 
                                id="exitQuizBtn"
                                aria-label="Testi bÄ±rak ve Ã§Ä±k"
                                data-i18n-title="quiz.exit">
                                âŒ <span data-i18n="quiz.exit">Ã‡Ä±kÄ±ÅŸ</span>
                            </button>
                        </div>

                        <div class="quiz-progress-bar" role="progressbar" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100">
                            <div class="quiz-progress-fill" id="progressFill"></div>
                        </div>

                        <article class="question-card">
                            <h2 class="question-text" id="questionText">
                                Ä°ÅŸletim sisteminin temel gÃ¶revlerinden biri nedir?
                            </h2>

                            <fieldset class="options-list" id="optionsList" aria-label="Cevap seÃ§enekleri">
                                <legend class="sr-only">CevabÄ±nÄ±zÄ± seÃ§in</legend>
                            </fieldset>
                        </article>

                        <nav class="quiz-actions" aria-label="Test navigasyonu">
                            <button class="btn btn-secondary" id="prevBtn" aria-label="Ã–nceki soru" style="display:none">
                                â† <span data-i18n="quiz.prev">Ã–nceki</span>
                            </button>
                            <button class="btn btn-primary" id="nextBtn" aria-label="Sonraki soru">
                                <span data-i18n="quiz.next">Sonraki</span> â†’
                            </button>
                            <button class="btn btn-primary" id="submitBtn" style="display:none" aria-label="Testi bitir" data-i18n="quiz.finish">
                                Testi Bitir
                            </button>
                        </nav>
                    </div>
                </div>

                <!-- Results Page -->
                <div class="test-page" id="resultsPage">
                    <article class="results-container">
                        <div class="results-icon" aria-hidden="true">ğŸ†</div>
                        <h1 class="results-title" data-i18n="results.title">Test TamamlandÄ±!</h1>
                        <div class="results-score" id="finalScore" role="status" aria-live="polite">8/10</div>
                        
                        <div class="results-stats" role="region" aria-label="Test sonuÃ§larÄ±">
                            <div class="result-stat">
                                <div class="result-value success-color" id="correctAnswers">8</div>
                                <div class="result-label" data-i18n="results.correct">DoÄŸru</div>
                            </div>
                            <div class="result-stat">
                                <div class="result-value danger-color" id="wrongAnswers">2</div>
                                <div class="result-label" data-i18n="results.wrong">YanlÄ±ÅŸ</div>
                            </div>
                            <div class="result-stat">
                                <div class="result-value primary-color" id="successPercent">80%</div>
                                <div class="result-label" data-i18n="results.success">BaÅŸarÄ±</div>
                            </div>
                            <div class="result-stat">
                                <time class="result-value" id="totalTimeResult">00:00</time>
                                <div class="result-label" data-i18n="results.time">SÃ¼re</div>
                            </div>
                        </div>

                        <nav class="quiz-actions" aria-label="SonuÃ§ sayfasÄ± aksiyonlarÄ±">
                            <button class="btn btn-secondary" id="reviewBtn" aria-label="CevaplarÄ± incele" data-i18n="results.review">
                                CevaplarÄ± GÃ¶r
                            </button>
                            <button class="btn btn-primary" id="newQuizBtn" aria-label="Yeni test baÅŸlat" data-i18n="results.newTest">
                                Yeni Test
                            </button>
                        </nav>
                    </article>
                </div>
            </section>

            <!-- Create Test Tab -->
            <section class="tab-content" id="create" role="tabpanel" aria-labelledby="tab-create">
                <h1 data-i18n="create.title">Test OluÅŸtur</h1>
                
                <form class="create-test-form" id="createTestForm" aria-label="Test oluÅŸturma formu">
                    <div class="form-group">
                        <label for="testTitle"><span data-i18n="create.testTitle">Test BaÅŸlÄ±ÄŸÄ±</span> <span class="required">*</span></label>
                        <input 
                            type="text" 
                            id="testTitle" 
                            name="testTitle"
                            data-i18n-placeholder="create.testTitlePlaceholder"
                            placeholder="Ã–rn: Matematik Final SÄ±navÄ±" 
                            required
                            maxlength="100"
                            aria-required="true">
                        <span class="error-message" id="testTitleError" role="alert"></span>
                    </div>
                    
                    <div class="form-group">
                        <label for="testCategory"><span data-i18n="create.category">Kategori</span> <span class="required">*</span></label>
                        <select id="testCategory" name="testCategory" required aria-required="true">
                            <option value="" data-i18n="create.selectCategory">SeÃ§iniz...</option>
                            <option value="matematik" data-i18n="category.matematik">Matematik</option>
                            <option value="fen" data-i18n="category.fen">Fen Bilimleri</option>
                            <option value="turkce" data-i18n="category.turkce">TÃ¼rkÃ§e</option>
                            <option value="sosyal" data-i18n="category.sosyal">Sosyal Bilgiler</option>
                            <option value="ingilizce" data-i18n="category.ingilizce">Ä°ngilizce</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="fileUpload" data-i18n="create.upload">Dosya YÃ¼kle</label>
                        <div class="file-upload-area" id="fileUploadArea">
                            <input 
                                type="file" 
                                id="fileUpload" 
                                name="fileUpload"
                                accept=".pdf,.docx,.txt"
                                aria-label="Dosya seÃ§">
                            <div class="file-upload-content">
                                <div class="file-icon" aria-hidden="true">ğŸ“</div>
                                <p data-i18n="create.uploadDesc">PDF, DOCX veya TXT dosyasÄ± yÃ¼kle</p>
                                <p class="file-hint" data-i18n="create.uploadHint">veya sÃ¼rÃ¼kle bÄ±rak</p>
                            </div>
                        </div>
                        <div id="fileInfo" class="file-info" role="status"></div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-large">
                        <span role="img" aria-hidden="true">ğŸ¤–</span> <span data-i18n="create.submit">Testfy ile OluÅŸtur</span>
                    </button>
                </form>
            </section>

            <!-- Library Tab -->
            <section class="tab-content" id="library" role="tabpanel" aria-labelledby="tab-library">
                <div class="library-header">
                    <h1>ğŸ“š <span data-i18n="library.title">KÃ¼tÃ¼phanem</span></h1>
                    <p style="color: var(--text-secondary); margin-bottom: var(--spacing-xl);" data-i18n="library.desc">
                        AI ile oluÅŸturduÄŸun testler burada saklanÄ±r (24 saat)
                    </p>
                </div>
                <div id="libraryList" class="library-list">
                    <div class="empty-state">
                        <div class="empty-state-icon" aria-hidden="true">ğŸ“š</div>
                        <p data-i18n="library.empty">HenÃ¼z test oluÅŸturmadÄ±n</p>
                        <p style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 8px;" data-i18n="library.emptyDesc">
                            AI'dan "test oluÅŸtur" diyerek baÅŸla!
                        </p>
                    </div>
                </div>
            </section>

            <!-- Notes Tab -->
            <section class="tab-content" id="notes" role="tabpanel" aria-labelledby="tab-notes">
                <div class="notes-header">
                    <h1 data-i18n="notes.title">NotlarÄ±m</h1>
                    <button class="btn btn-primary" id="addNoteBtn" aria-label="Yeni not ekle">
                        <span aria-hidden="true">+</span> <span data-i18n="notes.add">Yeni Not</span>
                    </button>
                </div>
                <div id="notesList" class="notes-list">
                    <div class="empty-state">
                        <div class="empty-state-icon" aria-hidden="true">ğŸ“</div>
                        <p data-i18n="notes.empty">HenÃ¼z not eklemedin</p>
                    </div>
                </div>
            </section>

            <!-- Leaderboard Tab -->
            <section class="tab-content" id="leaderboard" role="tabpanel" aria-labelledby="tab-leaderboard">
                <article class="leaderboard-container">
                    <header class="leaderboard-header">
                        <h1>ğŸ† <span data-i18n="leaderboard.title">Liderlik Tablosu</span></h1>
                        <p data-i18n="leaderboard.period">HaftalÄ±k SÄ±ralama</p>
                    </header>
                    
                    <div class="table-responsive">
                        <table class="leaderboard-table" role="table" aria-label="Liderlik tablosu">
                            <thead>
                                <tr>
                                    <th scope="col" data-i18n="leaderboard.rank">SÄ±ra</th>
                                    <th scope="col" data-i18n="leaderboard.user">KullanÄ±cÄ±</th>
                                    <th scope="col" data-i18n="leaderboard.xp">XP</th>
                                    <th scope="col" data-i18n="leaderboard.tests">Test</th>
                                    <th scope="col" data-i18n="leaderboard.success">BaÅŸarÄ±</th>
                                </tr>
                            </thead>
                            <tbody id="leaderboardBody">
                                <tr>
                                    <td colspan="5" class="empty-cell" data-i18n="leaderboard.empty">
                                        HenÃ¼z veri bulunmuyor
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </article>

                <!-- Ad Banner -->
                <aside class="ad-banner" aria-label="Reklam">
                    <div id="ad-leaderboard" class="ad-container">
                        <span>ğŸ“¢ Reklam AlanÄ± (728x90)</span>
                    </div>
                </aside>
            </section>

            <!-- Analysis Tab -->
            <section class="tab-content" id="analysis" role="tabpanel" aria-labelledby="tab-analysis">
                <h1 data-i18n="analysis.title">Performans Analizi</h1>
                <div id="analysisContent">
                    <div class="empty-state">
                        <div class="empty-state-icon" aria-hidden="true">ğŸ“ˆ</div>
                        <p data-i18n="analysis.empty">Analiz iÃ§in daha fazla test Ã§Ã¶z</p>
                    </div>
                </div>
            </section>

            <!-- Settings Tab -->
            <section class="tab-content" id="settings" role="tabpanel" aria-labelledby="tab-settings">
                <h1 data-i18n="settings.title">Ayarlar</h1>
                
                <form class="settings-form" id="settingsForm" aria-label="Ayarlar formu">
                    <div class="form-group">
                        <label for="username"><span data-i18n="settings.username">KullanÄ±cÄ± AdÄ±</span> <span class="required">*</span></label>
                        <input 
                            type="text" 
                            id="username" 
                            name="username"
                            value="user123"
                            required
                            minlength="3"
                            maxlength="20"
                            aria-required="true">
                        <span class="error-message" id="usernameError" role="alert"></span>
                    </div>
                    
                    <div class="form-group">
                        <label for="email"><span data-i18n="settings.email">E-posta</span> <span class="required">*</span></label>
                        <input 
                            type="email" 
                            id="email" 
                            name="email"
                            value="user@example.com"
                            required
                            aria-required="true">
                        <span class="error-message" id="emailError" role="alert"></span>
                    </div>
                    
                    <div class="form-group">
                        <label for="notifications" data-i18n="settings.notifications">Bildirimler</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="emailNotif" name="emailNotif" checked>
                                <span data-i18n="settings.emailNotif">E-posta bildirimleri</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="pushNotif" name="pushNotif">
                                <span data-i18n="settings.pushNotif">Push bildirimleri</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary" data-i18n="settings.save">Kaydet</button>
                        <button type="button" class="btn btn-secondary" id="resetBtn" data-i18n="settings.reset">SÄ±fÄ±rla</button>
                    </div>
                </form>
            </section>
        </main>
    </div>

    <!-- Bottom Ad Banner -->
    <aside class="ad-banner" aria-label="Reklam" role="complementary">
        <div id="ad-bottom" class="ad-container">
            <span>ğŸ“¢ Reklam AlanÄ± (728x90)</span>
        </div>
    </aside>

    <!-- Floating Testfy Assistant -->
    <div class="chat-widget-wrapper" aria-live="polite">
        <button id="chatToggleBtn" class="chat-toggle-btn" type="button" aria-label="Testfy asistanÄ±nÄ± aÃ§">
            <span class="chat-toggle-initial">T</span>
            <span class="chat-toggle-text">Testfy</span>
        </button>

        <section class="chat-widget" id="chatWidget" role="complementary" aria-label="Testfy asistanÄ±" aria-hidden="true">
            <header class="chat-header">
                <div class="chat-title">
                    <span class="chat-title-main">Testfy</span>
                    <div class="chat-status">
                        <span class="status-dot" aria-hidden="true"></span>
                        <span data-i18n="ai.status">Ã‡evrimiÃ§i</span>
                    </div>
                </div>
                <div class="chat-header-actions">
                    <button type="button" class="chat-header-btn" id="chatMinimizeBtn" aria-label="Pencereyi kÃ¼Ã§Ã¼lt">âˆ’</button>
                    <button type="button" class="chat-header-btn" id="chatCloseBtn" aria-label="Pencereyi kapat">âœ•</button>
                </div>
            </header>

            <div class="chat-body">
                <div class="ai-chat" id="aiChat" role="log" aria-live="polite" aria-atomic="false">
                    <!-- Mesajlar buraya eklenecek -->
                </div>
            </div>

            <footer class="chat-footer">
                <div class="ai-input-container">
                    <div class="ai-input-group">
                        <label for="aiInput" class="sr-only">Testfy asistanÄ±na mesajÄ±nÄ±z</label>
                        <input 
                            type="text" 
                            class="ai-input" 
                            id="aiInput" 
                            data-i18n-placeholder="ai.placeholder"
                            placeholder="Testfy asistanÄ±na sor..." 
                            maxlength="500"
                            aria-label="Mesaj giriÅŸ alanÄ±"
                            autocomplete="off" />
                        <button 
                            type="button" 
                            class="ai-send-btn" 
                            id="aiSendBtn"
                            aria-label="Mesaj gÃ¶nder"
                            data-i18n="ai.send">â†’</button>
                    </div>
                </div>
            </footer>
        </section>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" aria-hidden="true">
        <div class="loading-spinner" role="status">
            <span class="sr-only" data-i18n="msg.loading">YÃ¼kleniyor...</span>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast-container" id="toastContainer" role="status" aria-live="polite" aria-atomic="true"></div>

    <!-- External JavaScript -->
    <script src="utils.js"></script>
    <script src="config.js"></script>
    <script src="storage.js"></script>
    <script src="sorular.js"></script>
    <script src="language.js"></script>
    <script src="testify-ai.js"></script>
    <script src="library.js"></script>

    <!-- BirleÅŸtirilmiÅŸ APP + QUIZ + CHAT JS -->
    <script>
/**
 * TESTIFY MAIN APPLICATION - TAM HATASIZ
 * TÃ¼m Ã¶zellikler Ã§alÄ±ÅŸÄ±r hale getiren ana uygulama
 */

'use strict';

const App = {
    /**
     * UygulamayÄ± baÅŸlatÄ±r
     */
    init() {
        console.log('ğŸ“ Testify baÅŸlatÄ±lÄ±yor...');
        
        try {
            // Storage'Ä± kontrol et
            this.checkStorage();
            
            // KullanÄ±cÄ± verilerini yÃ¼kle
            this.loadUserData();
            
            // Tema yÃ¼kle
            this.loadTheme();
            
            // Event listener'larÄ± ekle
            this.attachEventListeners();
            
            // Dashboard'Ä± gÃ¼ncelle
            this.updateDashboard();
            
            // Leaderboard'Ä± gÃ¼ncelle
            this.updateLeaderboard();
            
            console.log('âœ… Testify hazÄ±r!');
        } catch (error) {
            console.error('âŒ BaÅŸlatma hatasÄ±:', error);
            Utils.handleError(error, 'App.init');
        }
    },

    /**
     * Storage kontrolÃ¼
     */
    checkStorage() {
        try {
            const test = '__storage_test__';
            localStorage.setItem(test, test);
            localStorage.removeItem(test);
        } catch (e) {
            Utils.showToast('LocalStorage kullanÄ±lamÄ±yor! Veriler kaydedilmeyecek.', 'warning');
            console.error('Storage hatasÄ±:', e);
        }
    },

    /**
     * KullanÄ±cÄ± verilerini yÃ¼kler
     */
    loadUserData() {
        try {
            const userData = StorageManager.getUserData();
            
            // Header'daki bilgileri gÃ¼ncelle
            const userAvatar = document.getElementById('userAvatar');
            const streak = document.getElementById('streak');
            const totalPoints = document.getElementById('totalPoints');
            const rank = document.getElementById('rank');
            
            if (userAvatar) {
                userAvatar.textContent = userData.username.charAt(0).toUpperCase();
            }
            
            if (streak) {
                const streakText = window.t ? t('header.streak', 'GÃ¼n') : 'GÃ¼n';
                const streakSpan = streak.querySelector('span[data-i18n="header.streak"]');
                if (streakSpan) {
                    streak.innerHTML = `${userData.stats.streak} <span data-i18n="header.streak">${streakText}</span>`;
                } else {
                    streak.textContent = userData.stats.streak + ' ' + streakText;
                }
            }
            
            if (totalPoints) {
                const xpText = window.t ? t('header.points', 'XP') : 'XP';
                const xpSpan = totalPoints.querySelector('span[data-i18n="header.points"]');
                if (xpSpan) {
                    totalPoints.innerHTML = `${userData.stats.xp} <span data-i18n="header.points">${xpText}</span>`;
                } else {
                    totalPoints.textContent = userData.stats.xp + ' ' + xpText;
                }
            }
            
            if (rank) {
                rank.textContent = userData.stats.rank ? '#' + userData.stats.rank : '#--';
            }
        } catch (error) {
            console.error('KullanÄ±cÄ± verisi yÃ¼kleme hatasÄ±:', error);
            Utils.handleError(error, 'loadUserData');
        }
    },

    /**
     * Tema yÃ¶neticisi
     */
    themeManager: {
        toggle() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            html.setAttribute('data-theme', newTheme);
            
            const themeIcon = document.getElementById('themeIcon');
            if (themeIcon) {
                themeIcon.textContent = newTheme === 'light' ? 'â˜€ï¸' : 'ğŸŒ™';
            }
            
            const themeBtn = document.querySelector('.theme-toggle');
            if (themeBtn) {
                themeBtn.setAttribute('aria-pressed', newTheme === 'dark');
            }
            
            Utils.setToStorage(Config.STORAGE_KEYS.THEME, newTheme);
        }
    },

    /**
     * TemayÄ± yÃ¼kler
     */
    loadTheme() {
        const savedTheme = Utils.getFromStorage(Config.STORAGE_KEYS.THEME, 'light');
        document.documentElement.setAttribute('data-theme', savedTheme);
        
        const themeIcon = document.getElementById('themeIcon');
        if (themeIcon) {
            themeIcon.textContent = savedTheme === 'light' ? 'â˜€ï¸' : 'ğŸŒ™';
        }
        
        const themeBtn = document.querySelector('.theme-toggle');
        if (themeBtn) {
            themeBtn.setAttribute('aria-pressed', savedTheme === 'dark');
        }
    },

    /**
     * âœ… DÃœZELTME: Tab navigasyonu - Library kontrolÃ¼ eklendi
     */
    switchTab(tabName) {
        try {
            // Tab butonlarÄ±nÄ± gÃ¼ncelle
            document.querySelectorAll('.nav-tab').forEach(tab => {
                const isActive = tab.dataset.tab === tabName;
                tab.classList.toggle('active', isActive);
                tab.setAttribute('aria-selected', isActive);
            });

            // Tab iÃ§eriklerini gÃ¼ncelle
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.toggle('active', content.id === tabName);
            });

            // âœ… Tab'a Ã¶zel yÃ¼klemeler
            switch(tabName) {
                case 'library':
                    // âœ… DÃœZELTME: LibraryManager kontrolÃ¼
                    if (window.LibraryManager && typeof LibraryManager.loadLibrary === 'function') {
                        LibraryManager.loadLibrary();
                    } else {
                        console.warn('âš ï¸ LibraryManager henÃ¼z yÃ¼klenmedi');
                        // Biraz bekleyip tekrar dene
                        setTimeout(() => {
                            if (window.LibraryManager) {
                                LibraryManager.loadLibrary();
                            } else {
                                console.error('âŒ LibraryManager yÃ¼klenemedi');
                            }
                        }, 100);
                    }
                    break;
                case 'leaderboard':
                    this.updateLeaderboard();
                    break;
                case 'notes':
                    this.updateNotes();
                    break;
                case 'analysis':
                    this.updateAnalysis();
                    break;
                case 'dashboard':
                    this.updateDashboard();
                    break;
            }
        } catch (error) {
            console.error('Tab deÄŸiÅŸtirme hatasÄ±:', error);
            Utils.handleError(error, 'switchTab');
        }
    },

    /**
     * Dashboard'Ä± gÃ¼nceller
     */
    updateDashboard() {
        try {
            const userData = StorageManager.getUserData();
            const stats = userData.stats;

            const totalTests = document.getElementById('totalTests');
            const totalQuestions = document.getElementById('totalQuestions');
            const successRate = document.getElementById('successRate');
            const avgTime = document.getElementById('avgTime');

            if (totalTests) totalTests.textContent = stats.totalTests;
            if (totalQuestions) totalQuestions.textContent = stats.totalQuestions;
            
            if (successRate) {
                const rate = stats.totalQuestions > 0 
                    ? Math.round((stats.correctAnswers / stats.totalQuestions) * 100)
                    : 0;
                successRate.textContent = rate + '%';
            }
            
            if (avgTime) {
                const avg = stats.totalTests > 0 
                    ? Math.round(stats.totalTime / stats.totalTests)
                    : 0;
                avgTime.textContent = avg + 's';
            }

            // Son aktiviteleri gÃ¶ster
            this.updateActivityList();
        } catch (error) {
            console.error('Dashboard gÃ¼ncelleme hatasÄ±:', error);
            Utils.handleError(error, 'updateDashboard');
        }
    },

    /**
     * Aktivite listesini gÃ¼nceller
     */
    updateActivityList() {
        try {
            const activities = StorageManager.getActivities(5);
            const activityList = document.getElementById('activityList');
            
            if (!activityList) return;

            if (activities.length === 0) {
                const emptyText = window.t 
                    ? t('dashboard.empty', 'HenÃ¼z aktivite yok. Test Ã§Ã¶zerek baÅŸla!')
                    : 'HenÃ¼z aktivite yok. Test Ã§Ã¶zerek baÅŸla!';
                
                activityList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“Š</div>
                        <p>${emptyText}</p>
                    </div>
                `;
                return;
            }

            activityList.innerHTML = activities.map(activity => `
                <div class="activity-item" style="padding: 15px; background: var(--bg-secondary); border-radius: 8px; margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${this.getActivityTitle(activity)}</strong>
                            <p style="margin: 5px 0 0; color: var(--text-secondary); font-size: 0.9rem;">
                                ${this.getActivityDescription(activity)}
                            </p>
                        </div>
                        <small style="color: var(--text-tertiary);">
                            ${Utils.formatDate(activity.timestamp)}
                        </small>
                    </div>
                </div>
            `).join('');
        } catch (error) {
            console.error('Aktivite listesi hatasÄ±:', error);
        }
    },

    /**
     * Aktivite baÅŸlÄ±ÄŸÄ±
     */
    getActivityTitle(activity) {
        const titles = {
            'test_completed': 'âœ… ' + (window.t ? t('activity.testCompleted', 'Test TamamlandÄ±') : 'Test TamamlandÄ±'),
            'test_saved': 'ğŸ’¾ ' + (window.t ? t('activity.testSaved', 'Test Kaydedildi') : 'Test Kaydedildi'),
            'test_exported': 'ğŸ“¥ ' + (window.t ? t('activity.testExported', 'Test Ä°ndirildi') : 'Test Ä°ndirildi'),
            'note_created': 'ğŸ“ ' + (window.t ? t('activity.noteCreated', 'Not OluÅŸturuldu') : 'Not OluÅŸturuldu'),
            'level_up': 'ğŸ‰ ' + (window.t ? t('activity.levelUp', 'Level AtlandÄ±') : 'Level AtlandÄ±')
        };
        return titles[activity.type] || 'Aktivite';
    },

    /**
     * Aktivite aÃ§Ä±klamasÄ±
     */
    getActivityDescription(activity) {
        switch(activity.type) {
            case 'test_completed':
                return `${activity.data.correctAnswers}/${activity.data.totalQuestions} doÄŸru - %${activity.data.successRate} baÅŸarÄ±`;
            case 'test_saved':
                return `${activity.data.title} - ${activity.data.questionCount} soru`;
            case 'test_exported':
                return `${activity.data.title} - ${activity.data.format.toUpperCase()}`;
            case 'note_created':
                return activity.data.title || 'Yeni not';
            case 'level_up':
                return `Level ${activity.data.level}!`;
            default:
                return '';
        }
    },

    /**
     * Leaderboard'Ä± gÃ¼nceller
     */
    updateLeaderboard() {
        try {
            const leaderboard = StorageManager.getLeaderboard(100);
            const tbody = document.getElementById('leaderboardBody');
            
            if (!tbody) return;

            if (leaderboard.length === 0) {
                const emptyText = window.t 
                    ? t('leaderboard.empty', 'HenÃ¼z veri bulunmuyor')
                    : 'HenÃ¼z veri bulunmuyor';
                
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="empty-cell">${emptyText}</td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = leaderboard.map(user => `
                <tr>
                    <td>
                        <span class="rank-badge ${this.getRankClass(user.rank)}">${user.rank}</span>
                    </td>
                    <td>
                        <div class="user-info">
                            <div class="user-avatar-small">${user.username.charAt(0).toUpperCase()}</div>
                            <span>${Utils.sanitizeHTML(user.username)}</span>
                        </div>
                    </td>
                    <td><strong>${user.xp} XP</strong></td>
                    <td>${user.totalTests}</td>
                    <td><span style="color: var(--success);">${user.successRate}%</span></td>
                </tr>
            `).join('');
        } catch (error) {
            console.error('Leaderboard gÃ¼ncelleme hatasÄ±:', error);
            Utils.handleError(error, 'updateLeaderboard');
        }
    },

    /**
     * Rank class
     */
    getRankClass(rank) {
        if (rank === 1) return 'rank-1';
        if (rank === 2) return 'rank-2';
        if (rank === 3) return 'rank-3';
        return 'rank-default';
    },

    /**
     * NotlarÄ± gÃ¼nceller
     */
    updateNotes() {
        try {
            const notes = StorageManager.getNotes();
            const notesList = document.getElementById('notesList');
            
            if (!notesList) return;

            if (notes.length === 0) {
                const emptyText = window.t 
                    ? t('notes.empty', 'HenÃ¼z not eklemedin')
                    : 'HenÃ¼z not eklemedin';
                
                notesList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“š</div>
                        <p>${emptyText}</p>
                    </div>
                `;
                return;
            }

            notesList.innerHTML = notes.map(note => {
                const editText = window.t ? t('notes.edit', 'DÃ¼zenle') : 'DÃ¼zenle';
                const deleteText = window.t ? t('notes.delete', 'Sil') : 'Sil';
                
                return `
                    <div class="note-card">
                        <h3 class="note-title">${Utils.sanitizeHTML(note.title || 'BaÅŸlÄ±ksÄ±z Not')}</h3>
                        <p class="note-content">${Utils.sanitizeHTML(note.content || '')}</p>
                        <div class="note-meta">
                            <span>${Utils.formatDate(note.createdAt)}</span>
                            <div>
                                <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 0.85rem;" onclick="App.editNote('${note.id}')">
                                    ${editText}
                                </button>
                                <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 0.85rem;" onclick="App.deleteNote('${note.id}')">
                                    ${deleteText}
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        } catch (error) {
            console.error('Notlar gÃ¼ncelleme hatasÄ±:', error);
            Utils.handleError(error, 'updateNotes');
        }
    },

    /**
     * Not ekler
     */
    async addNote() {
        try {
            const titlePrompt = window.t ? t('notes.titlePrompt', 'Not BaÅŸlÄ±ÄŸÄ±:') : 'Not BaÅŸlÄ±ÄŸÄ±:';
            const contentPrompt = window.t ? t('notes.contentPrompt', 'Not Ä°Ã§eriÄŸi:') : 'Not Ä°Ã§eriÄŸi:';
            
            const title = prompt(titlePrompt);
            if (!title) return;

            const content = prompt(contentPrompt);
            if (!content) return;

            const note = {
                title: title,
                content: content
            };

            if (StorageManager.saveNote(note)) {
                this.updateNotes();
            }
        } catch (error) {
            console.error('Not ekleme hatasÄ±:', error);
            Utils.handleError(error, 'addNote');
        }
    },

    /**
     * Not dÃ¼zenler
     */
    async editNote(noteId) {
        try {
            const notes = StorageManager.getNotes();
            const note = notes.find(n => n.id === noteId);
            
            if (!note) return;

            const titlePrompt = window.t ? t('notes.titlePrompt', 'Not BaÅŸlÄ±ÄŸÄ±:') : 'Not BaÅŸlÄ±ÄŸÄ±:';
            const contentPrompt = window.t ? t('notes.contentPrompt', 'Not Ä°Ã§eriÄŸi:') : 'Not Ä°Ã§eriÄŸi:';
            
            const title = prompt(titlePrompt, note.title);
            if (title === null) return;

            const content = prompt(contentPrompt, note.content);
            if (content === null) return;

            note.title = title;
            note.content = content;

            if (StorageManager.saveNote(note)) {
                this.updateNotes();
            }
        } catch (error) {
            console.error('Not dÃ¼zenleme hatasÄ±:', error);
            Utils.handleError(error, 'editNote');
        }
    },

    /**
     * Not siler
     */
    async deleteNote(noteId) {
        try {
            const confirmMsg = window.t 
                ? t('notes.deleteConfirm', 'Bu notu silmek istediÄŸinizden emin misiniz?')
                : 'Bu notu silmek istediÄŸinizden emin misiniz?';
            
            const confirmed = await Utils.confirm(confirmMsg);
            
            if (confirmed && StorageManager.deleteNote(noteId)) {
                this.updateNotes();
            }
        } catch (error) {
            console.error('Not silme hatasÄ±:', error);
            Utils.handleError(error, 'deleteNote');
        }
    },

    /**
     * Analiz sayfasÄ±nÄ± gÃ¼nceller
     */
    updateAnalysis() {
        try {
            const userData = StorageManager.getUserData();
            const stats = userData.stats;
            const analysisContent = document.getElementById('analysisContent');
            
            if (!analysisContent) return;

            if (stats.totalTests === 0) {
                const emptyText = window.t 
                    ? t('analysis.empty', 'Analiz iÃ§in daha fazla test Ã§Ã¶z')
                    : 'Analiz iÃ§in daha fazla test Ã§Ã¶z';
                
                analysisContent.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“ˆ</div>
                        <p>${emptyText}</p>
                    </div>
                `;
                return;
            }

            const successRate = Math.round((stats.correctAnswers / stats.totalQuestions) * 100);
            const avgTime = Math.round(stats.totalTime / stats.totalTests);

            const avgSuccessText = window.t ? t('analysis.avgSuccess', 'Ortalama BaÅŸarÄ±') : 'Ortalama BaÅŸarÄ±';
            const avgTimeText = window.t ? t('analysis.avgTime', 'Ortalama SÃ¼re') : 'Ortalama SÃ¼re';
            const totalCorrectText = window.t ? t('analysis.totalCorrect', 'Toplam DoÄŸru') : 'Toplam DoÄŸru';
            const totalWrongText = window.t ? t('analysis.totalWrong', 'Toplam YanlÄ±ÅŸ') : 'Toplam YanlÄ±ÅŸ';
            const evaluationText = window.t ? t('analysis.evaluation', 'Performans DeÄŸerlendirmesi') : 'Performans DeÄŸerlendirmesi';

            analysisContent.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“Š</div>
                        <div class="stat-value">${successRate}%</div>
                        <div class="stat-label">${avgSuccessText}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">â±ï¸</div>
                        <div class="stat-value">${Utils.formatTime(avgTime)}</div>
                        <div class="stat-label">${avgTimeText}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ¯</div>
                        <div class="stat-value">${stats.correctAnswers}</div>
                        <div class="stat-label">${totalCorrectText}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">âŒ</div>
                        <div class="stat-value">${stats.wrongAnswers}</div>
                        <div class="stat-label">${totalWrongText}</div>
                    </div>
                </div>
                <div style="margin-top: 30px; padding: 20px; background: var(--bg-secondary); border-radius: 10px;">
                    <h3>${evaluationText}</h3>
                    <p style="margin-top: 10px; line-height: 1.6;">
                        ${this.getPerformanceText(successRate)}
                    </p>
                </div>
            `;
        } catch (error) {
            console.error('Analiz gÃ¼ncelleme hatasÄ±:', error);
            Utils.handleError(error, 'updateAnalysis');
        }
    },

    /**
     * Performans metni (TR/EN)
     */
    getPerformanceText(successRate) {
        const lang =
            window.LanguageManager && LanguageManager.currentLang === 'en' ? 'en' : 'tr';

        if (lang === 'en') {
            if (successRate >= 90) {
                return 'ğŸŒŸ Excellent! Your performance is great. Keep it up!';
            } else if (successRate >= 75) {
                return 'ğŸ‘ Very good! Strong performance. With a bit more study you can improve even further.';
            } else if (successRate >= 60) {
                return 'ğŸ’ª You are doing well! With some more practice you can reach your goals.';
            } else if (successRate >= 40) {
                return 'ğŸ“š You need to study more. Regular practice will help you improve.';
            } else {
                return 'ğŸ¯ It is recommended to review the basics. Keep going step by step!';
            }
        } else {
            if (successRate >= 90) {
                return 'ğŸŒŸ MÃ¼kemmel! Harika bir performans gÃ¶steriyorsun. BÃ¶yle devam et!';
            } else if (successRate >= 75) {
                return 'ğŸ‘ Ã‡ok iyi! BaÅŸarÄ±lÄ± bir performans. Biraz daha Ã§alÄ±ÅŸarak daha da iyileÅŸtirebilirsin.';
            } else if (successRate >= 60) {
                return 'ğŸ’ª Ä°yi gidiyorsun! Biraz daha pratik yaparsan hedeflerine ulaÅŸabilirsin.';
            } else if (successRate >= 40) {
                return 'ğŸ“š Daha fazla Ã§alÄ±ÅŸma gerekiyor. DÃ¼zenli pratik yaparak geliÅŸebilirsin.';
            } else {
                return 'ğŸ¯ Temel konularÄ± tekrar etmen Ã¶nerilir. YavaÅŸ yavaÅŸ ilerlemeye devam et!';
            }
        }
    },

    /**
     * âœ… DÃœZELTME: AyarlarÄ± kaydeder - Validation ile
     */
    saveSettings(event) {
        event.preventDefault();

        try {
            const form = event.target;
            const usernameInput = form.username;
            const emailInput = form.email;

            // âœ… Validation
            const isUsernameValid = Utils.validateInput(usernameInput, 'username');
            const isEmailValid = Utils.validateInput(emailInput, 'email');

            if (!isUsernameValid || !isEmailValid) {
                return;
            }

            const username = usernameInput.value.trim();
            const email = emailInput.value.trim();

            // Kaydet
            const settings = {
                username: username,
                email: email,
                notifications: {
                    email: form.emailNotif.checked,
                    push: form.pushNotif.checked
                }
            };

            const userData = StorageManager.getUserData();
            userData.username = username;
            userData.email = email;
            userData.settings.notifications = settings.notifications;

            if (StorageManager.updateUserData(userData)) {
                const successMsg = window.t ? t('msg.saved', 'BaÅŸarÄ±yla kaydedildi!') : 'BaÅŸarÄ±yla kaydedildi!';
                Utils.showToast(successMsg, 'success');
                this.loadUserData();
            } else {
                const errorMsg = window.t ? t('msg.error', 'Bir hata oluÅŸtu!') : 'Bir hata oluÅŸtu!';
                Utils.showToast(errorMsg, 'error');
            }
        } catch (error) {
            console.error('Ayar kaydetme hatasÄ±:', error);
            Utils.handleError(error, 'saveSettings');
        }
    },

    /**
     * AyarlarÄ± sÄ±fÄ±rlar
     */
    async resetSettings() {
        try {
            const confirmMsg = window.t 
                ? t('settings.resetConfirm', 'Ayarlar varsayÄ±lan deÄŸerlere dÃ¶necek. Emin misiniz?')
                : 'Ayarlar varsayÄ±lan deÄŸerlere dÃ¶necek. Emin misiniz?';
            
            const confirmed = await Utils.confirm(confirmMsg);
            
            if (!confirmed) return;

            const userData = StorageManager.getUserData();
            document.getElementById('username').value = userData.username;
            document.getElementById('email').value = userData.email || '';
            document.getElementById('emailNotif').checked = true;
            document.getElementById('pushNotif').checked = false;

            const infoMsg = window.t ? t('msg.reset', 'Ayarlar sÄ±fÄ±rlandÄ±') : 'Ayarlar sÄ±fÄ±rlandÄ±';
            Utils.showToast(infoMsg, 'info');
        } catch (error) {
            console.error('Ayar sÄ±fÄ±rlama hatasÄ±:', error);
            Utils.handleError(error, 'resetSettings');
        }
    },

    /**
     * âœ… DÃœZELTME: Dosya yÃ¼kleme - Validation ile
     */
    handleFileUpload(event) {
        try {
            const file = event.target.files[0];
            if (!file) return;

            // Dosya boyutu kontrolÃ¼
            if (file.size > Config.FILE_UPLOAD.MAX_SIZE) {
                const errorMsg = window.t ? t('error.fileSize', 'Dosya boyutu Ã§ok bÃ¼yÃ¼k') : 'Dosya boyutu Ã§ok bÃ¼yÃ¼k';
                Utils.showToast(errorMsg, 'error');
                return;
            }

            // Dosya tÃ¼rÃ¼ kontrolÃ¼
            const ext = file.name.split('.').pop().toLowerCase();
            if (!Config.FILE_UPLOAD.ALLOWED_TYPES.includes(ext)) {
                const errorMsg = window.t ? t('error.fileType', 'Desteklenmeyen dosya tÃ¼rÃ¼') : 'Desteklenmeyen dosya tÃ¼rÃ¼';
                Utils.showToast(errorMsg, 'error');
                return;
            }

            // Dosya bilgisini gÃ¶ster
            const fileInfo = document.getElementById('fileInfo');
            if (fileInfo) {
                fileInfo.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span>ğŸ“„</span>
                        <div>
                            <div><strong>${Utils.sanitizeHTML(file.name)}</strong></div>
                            <small style="color: var(--text-secondary);">${Utils.formatFileSize(file.size)}</small>
                        </div>
                    </div>
                `;
            }

            const successMsg = window.t ? t('msg.fileUploaded', 'Dosya yÃ¼klendi!') : 'Dosya yÃ¼klendi!';
            Utils.showToast(successMsg, 'success');
        } catch (error) {
            console.error('Dosya yÃ¼kleme hatasÄ±:', error);
            Utils.handleError(error, 'handleFileUpload');
        }
    },

    /**
     * âœ… DÃœZELTME: Test oluÅŸturma formu - Validation ile
     */
    handleCreateTest(event) {
        event.preventDefault();

        try {
            const form = event.target;
            const titleInput = form.testTitle;
            const categorySelect = form.testCategory;

            // âœ… Validation
            const isTitleValid = Utils.validateInput(titleInput, 'required');
            
            if (!isTitleValid) {
                return;
            }

            const title = titleInput.value.trim();
            const category = categorySelect.value;

            if (!category) {
                const errorMsg = window.t ? t('error.categoryRequired', 'Kategori seÃ§melisiniz!') : 'Kategori seÃ§melisiniz!';
                Utils.showToast(errorMsg, 'error');
                return;
            }

            const infoMsg = window.t ? t('msg.featureComingSoon', 'Test oluÅŸturma Ã¶zelliÄŸi yakÄ±nda eklenecek!') : 'Test oluÅŸturma Ã¶zelliÄŸi yakÄ±nda eklenecek!';
            Utils.showToast(infoMsg, 'info');
            
            // Form sÄ±fÄ±rla
            form.reset();
            const fileInfo = document.getElementById('fileInfo');
            if (fileInfo) {
                fileInfo.innerHTML = '';
            }
        } catch (error) {
            console.error('Test oluÅŸturma hatasÄ±:', error);
            Utils.handleError(error, 'handleCreateTest');
        }
    },

    /**
     * Event listener'larÄ± ekler
     */
    attachEventListeners() {
        try {
            // Tab navigasyonu
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', () => this.switchTab(tab.dataset.tab));
            });

            // Ayarlar formu
            const settingsForm = document.getElementById('settingsForm');
            if (settingsForm) {
                settingsForm.addEventListener('submit', (e) => this.saveSettings(e));
            }

            // AyarlarÄ± sÄ±fÄ±rla
            const resetBtn = document.getElementById('resetBtn');
            if (resetBtn) {
                resetBtn.addEventListener('click', () => this.resetSettings());
            }

            // Dosya yÃ¼kleme
            const fileUpload = document.getElementById('fileUpload');
            if (fileUpload) {
                fileUpload.addEventListener('change', (e) => this.handleFileUpload(e));
            }

            // Test oluÅŸturma formu
            const createForm = document.getElementById('createTestForm');
            if (createForm) {
                createForm.addEventListener('submit', (e) => this.handleCreateTest(e));
            }

            // Not ekleme butonu
            const addNoteBtn = document.getElementById('addNoteBtn');
            if (addNoteBtn) {
                addNoteBtn.addEventListener('click', () => this.addNote());
            }

            // Tema deÄŸiÅŸtir
            window.themeManager = this.themeManager;

            console.log('âœ… Event listener\'lar eklendi');
        } catch (error) {
            console.error('Event listener hatasÄ±:', error);
            Utils.handleError(error, 'attachEventListeners');
        }
    }
};

// UygulamayÄ± baÅŸlat
document.addEventListener('DOMContentLoaded', () => {
    App.init();
});

// Export
window.App = App;

/**
 * TESTIFY QUIZ MANAGER - HATASIZ FINAL
 * TÃ¼m memory leak, event listener ve bug'lar dÃ¼zeltildi
 */

'use strict';

const QuizManager = {
    // Quiz durumu
    state: {
        currentMode: null,
        questions: [],
        currentIndex: 0,
        answers: [],
        startTime: null,
        timerInterval: null,
        elapsedSeconds: 0,
        isReviewing: false,
        testTitle: null,
        testDescription: null,
        eventListenersAttached: false // âœ… YENÄ°: Duplicate Ã¶nleme
    },

    /**
     * AI TARAFINDAN OLUÅTURULAN TESTÄ° YÃœKLE
     */
    loadAIGeneratedTest() {
        try {
            const aiTest = localStorage.getItem('testify_generated_test');
            if (!aiTest) {
                console.log('â„¹ï¸ AI testi bulunamadÄ±');
                return null;
            }
            
            const testData = JSON.parse(aiTest);
            
            // SÃ¼resi dolmuÅŸ mu kontrol et (24 saat)
            if (testData.expiresAt && Date.now() > testData.expiresAt) {
                console.log('â° AI testi sÃ¼resi dolmuÅŸ');
                localStorage.removeItem('testify_generated_test');
                return null;
            }
            
            console.log('âœ… AI testi yÃ¼klendi:', testData.title);
            console.log('ğŸ“Š Soru sayÄ±sÄ±:', testData.questions.length);
            return testData;
            
        } catch (error) {
            console.error('âŒ AI test yÃ¼kleme hatasÄ±:', error);
            return null;
        }
    },

    /**
     * Quiz'i baÅŸlatÄ±r - TAM HATASIZ
     */
    startQuiz(mode) {
        console.log('ğŸ¯ Quiz baÅŸlatÄ±lÄ±yor, mod:', mode);
        
        // âœ… Ã–nceki timer'Ä± temizle
        this.cleanupPreviousQuiz();
        
        try {
            // Ã–nce AI testi var mÄ± kontrol et
            const aiTest = this.loadAIGeneratedTest();
            
            if (aiTest && aiTest.questions && aiTest.questions.length > 0) {
                console.log('ğŸ¤– AI testi kullanÄ±lÄ±yor');
                
                // AI testini kullan
                this.state = {
                    currentMode: 'ai',
                    questions: aiTest.questions,
                    currentIndex: 0,
                    answers: [],
                    startTime: Date.now(),
                    timerInterval: null,
                    elapsedSeconds: 0,
                    isReviewing: false,
                    testTitle: aiTest.title,
                    testDescription: aiTest.description,
                    eventListenersAttached: this.state.eventListenersAttached
                };
                
                this.state.answers = new Array(aiTest.questions.length).fill(null);
                
                Utils.showToast(`ğŸ¤– AI Testi: ${aiTest.title} - ${aiTest.questions.length} soru`, 'info', 4000);
                
            } else {
                console.log('ğŸ“š VarsayÄ±lan sorular kullanÄ±lÄ±yor');
                
                // Soru bankasÄ± kontrolÃ¼
                if (!window.questionBank || !Array.isArray(window.questionBank)) {
                    Utils.showToast('Soru bankasÄ± yÃ¼klenemedi!', 'error');
                    console.error('questionBank bulunamadÄ±!');
                    return;
                }

                if (window.questionBank.length === 0) {
                    Utils.showToast('Soru bankasÄ± boÅŸ!', 'error');
                    return;
                }

                // TÃ¼m sorularÄ± karÄ±ÅŸtÄ±r ve al
                const allQuestions = [...window.questionBank];
                
                this.state = {
                    currentMode: mode,
                    questions: Utils.shuffleArray(allQuestions),
                    currentIndex: 0,
                    answers: [],
                    startTime: Date.now(),
                    timerInterval: null,
                    elapsedSeconds: 0,
                    isReviewing: false,
                    testTitle: null,
                    testDescription: null,
                    eventListenersAttached: this.state.eventListenersAttached
                };
                
                this.state.answers = new Array(this.state.questions.length).fill(null);
            }

            console.log(`âœ… ${this.state.questions.length} soru yÃ¼klendi`);

            // SayfalarÄ± deÄŸiÅŸtir
            const testSelection = document.getElementById('testSelection');
            const quizPage = document.getElementById('quizPage');
            
            if (!testSelection || !quizPage) {
                throw new Error('Quiz sayfalarÄ± bulunamadÄ±');
            }

            testSelection.classList.remove('active');
            quizPage.classList.add('active');

            // Exit butonunu gÃ¶ster
            this.showExitButton();

            // Timer'Ä± baÅŸlat
            this.startTimer();

            // Ä°lk soruyu gÃ¶ster
            this.displayQuestion();

            // Quiz durumunu kaydet
            this.saveState();

            const questionCount = this.state.questions.length;
            Utils.showToast(`Test baÅŸladÄ±! ${questionCount} soru - Bol ÅŸans!`, 'success');
            
        } catch (error) {
            console.error('âŒ Quiz baÅŸlatma hatasÄ±:', error);
            Utils.showToast('Test baÅŸlatÄ±lamadÄ±: ' + error.message, 'error');
        }
    },

    /**
     * âœ… YENÄ°: Ã–nceki quiz'i temizle
     */
    cleanupPreviousQuiz() {
        // Timer'Ä± durdur
        if (this.state.timerInterval) {
            clearInterval(this.state.timerInterval);
            this.state.timerInterval = null;
            console.log('ğŸ§¹ Ã–nceki timer temizlendi');
        }
        
        // Event listener'larÄ± temizle (gerekirse)
        const optionsList = document.getElementById('optionsList');
        if (optionsList) {
            optionsList.innerHTML = '';
        }
    },

    /**
     * Exit butonunu gÃ¶ster/gizle
     */
    showExitButton() {
        const exitBtn = document.getElementById('exitQuizBtn');
        if (exitBtn) {
            exitBtn.style.display = this.state.isReviewing ? 'none' : 'inline-flex';
        }
    },

    /**
     * Quiz durumunu kaydeder
     */
    saveState() {
        try {
            if (window.StorageManager) {
                StorageManager.saveQuizState({
                    currentMode: this.state.currentMode,
                    currentIndex: this.state.currentIndex,
                    answers: this.state.answers,
                    startTime: this.state.startTime,
                    elapsedSeconds: this.state.elapsedSeconds,
                    questionCount: this.state.questions.length
                });
            }
        } catch (error) {
            console.warn('Quiz durumu kaydedilemedi:', error);
        }
    },

    /**
     * Timer'Ä± baÅŸlatÄ±r
     */
    startTimer() {
        // âœ… Ã–nceki timer'Ä± temizle
        if (this.state.timerInterval) {
            clearInterval(this.state.timerInterval);
        }

        this.state.timerInterval = setInterval(() => {
            this.state.elapsedSeconds++;
            this.updateTimerDisplay();
            
            // Her 10 saniyede bir state'i kaydet
            if (this.state.elapsedSeconds % 10 === 0) {
                this.saveState();
            }
        }, 1000);
    },

    /**
     * Timer'Ä± durdurur
     */
    stopTimer() {
        if (this.state.timerInterval) {
            clearInterval(this.state.timerInterval);
            this.state.timerInterval = null;
            console.log('â¹ï¸ Timer durduruldu');
        }
    },

    /**
     * Timer'Ä± gÃ¼nceller
     */
    updateTimerDisplay() {
        const timerEl = document.getElementById('quizTimer');
        if (timerEl) {
            timerEl.textContent = Utils.formatTime(this.state.elapsedSeconds);
        }
    },

    /**
     * Soruyu gÃ¶sterir
     */
    displayQuestion() {
        try {
            const question = this.state.questions[this.state.currentIndex];
            if (!question) {
                throw new Error('Soru bulunamadÄ±');
            }

            // Soru numarasÄ± ve toplam
            const currentQuestionEl = document.getElementById('currentQuestion');
            const totalQuestionsEl = document.getElementById('totalQuestionsQuiz');
            
            if (currentQuestionEl) {
                currentQuestionEl.textContent = this.state.currentIndex + 1;
            }
            if (totalQuestionsEl) {
                totalQuestionsEl.textContent = this.state.questions.length;
            }

            // Progress bar
            const progress = ((this.state.currentIndex + 1) / this.state.questions.length) * 100;
            const progressFill = document.getElementById('progressFill');
            if (progressFill) {
                progressFill.style.width = progress + '%';
                const progressBar = progressFill.parentElement;
                if (progressBar) {
                    progressBar.setAttribute('aria-valuenow', Math.round(progress));
                }
            }

            // Soru metni
            const questionTextEl = document.getElementById('questionText');
            if (questionTextEl) {
                questionTextEl.textContent = question.q;
            }

            // SeÃ§enekleri gÃ¶ster
            this.displayOptions(question);

            // ButonlarÄ± gÃ¼ncelle
            this.updateButtons();
        } catch (error) {
            console.error('Soru gÃ¶sterme hatasÄ±:', error);
            Utils.showToast('Soru gÃ¶sterilemedi', 'error');
        }
    },

    /**
     * SeÃ§enekleri gÃ¶sterir
     */
    displayOptions(question) {
        const optionsList = document.getElementById('optionsList');
        if (!optionsList) return;

        // âœ… Eski event listener'larÄ± temizle
        optionsList.innerHTML = '';

        const letters = ['A', 'B', 'C', 'D', 'E'];

        question.o.forEach((option, index) => {
            const optionDiv = document.createElement('div');
            optionDiv.className = 'option-item';
            optionDiv.setAttribute('role', 'radio');
            optionDiv.setAttribute('aria-checked', 'false');
            optionDiv.setAttribute('tabindex', '0');
            
            // SeÃ§ilmiÅŸ mi kontrol et
            const isSelected = this.state.answers[this.state.currentIndex] === index;
            if (isSelected) {
                optionDiv.classList.add('selected');
                optionDiv.setAttribute('aria-checked', 'true');
            }

            // Review modundaysa doÄŸru/yanlÄ±ÅŸ gÃ¶ster
            if (this.state.isReviewing) {
                optionDiv.classList.add('disabled');
                const correctAnswer = question.a;
                const isCorrect = option === correctAnswer;
                const isUserAnswer = isSelected;
                
                if (isCorrect) {
                    optionDiv.classList.add('correct');
                }
                
                if (isUserAnswer && !isCorrect) {
                    optionDiv.classList.add('incorrect');
                }
            }

            optionDiv.innerHTML = `
                <span class="option-letter">${letters[index]}</span>
                <span>${Utils.sanitizeHTML(option)}</span>
            `;

            // âœ… Event listener (memory leak yok)
            if (!this.state.isReviewing) {
                const clickHandler = () => this.selectOption(index);
                const keyHandler = (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.selectOption(index);
                    }
                };
                
                optionDiv.addEventListener('click', clickHandler);
                optionDiv.addEventListener('keypress', keyHandler);
            }

            optionsList.appendChild(optionDiv);
        });

        // Review modunda aÃ§Ä±klama gÃ¶ster
        if (this.state.isReviewing && question.explanation) {
            const explanationDiv = document.createElement('div');
            explanationDiv.className = 'question-explanation';
            explanationDiv.innerHTML = `
                <div class="explanation-header">
                    <span class="explanation-icon">ğŸ’¡</span>
                    <strong>${window.t ? t('quiz.explanation', 'AÃ§Ä±klama') : 'AÃ§Ä±klama'}:</strong>
                </div>
                <p>${Utils.sanitizeHTML(question.explanation)}</p>
            `;
            optionsList.appendChild(explanationDiv);
        }
    },

    /**
     * SeÃ§enek seÃ§er
     */
    selectOption(index) {
        if (this.state.isReviewing) return;

        try {
            const question = this.state.questions[this.state.currentIndex];
            const selectedOption = question.o[index];
            const correctAnswer = question.a;
            const isCorrect = selectedOption === correctAnswer;

            // CevabÄ± kaydet
            this.state.answers[this.state.currentIndex] = index;

            // TÃ¼m seÃ§enekleri disable et
            document.querySelectorAll('.option-item').forEach((item, idx) => {
                item.classList.add('disabled');
                item.style.pointerEvents = 'none';
                
                // DoÄŸru cevabÄ± yeÅŸil yap
                if (question.o[idx] === correctAnswer) {
                    item.classList.add('correct');
                }
                
                // YanlÄ±ÅŸ seÃ§imi kÄ±rmÄ±zÄ± yap
                if (idx === index && !isCorrect) {
                    item.classList.add('incorrect');
                }
                
                if (idx === index) {
                    item.classList.add('selected');
                    item.setAttribute('aria-checked', 'true');
                } else {
                    item.classList.remove('selected');
                    item.setAttribute('aria-checked', 'false');
                }
            });

            // AÃ§Ä±klamayÄ± gÃ¶ster
            this.showExplanation(question, isCorrect);

            // State'i kaydet
            this.saveState();
        } catch (error) {
            console.error('SeÃ§enek seÃ§me hatasÄ±:', error);
        }
    },

    /**
     * AÃ§Ä±klamayÄ± gÃ¶sterir
     */
    showExplanation(question, isCorrect) {
        // Eski aÃ§Ä±klamayÄ± kaldÄ±r
        const oldExplanation = document.querySelector('.question-explanation');
        if (oldExplanation) {
            oldExplanation.remove();
        }

        // AÃ§Ä±klama yoksa Ã§Ä±k
        if (!question.explanation) return;

        const optionsList = document.getElementById('optionsList');
        if (!optionsList) return;

        const explanationDiv = document.createElement('div');
        explanationDiv.className = 'question-explanation';
        explanationDiv.style.cssText = 'margin-top: 20px; padding: 15px; background: var(--bg-tertiary); border-left: 4px solid var(--info); border-radius: 8px; animation: slideIn 0.3s ease-out;';
        
        const statusIcon = isCorrect ? 'âœ…' : 'âŒ';
        const statusText = isCorrect ? (window.t ? t('quiz.correct', 'DoÄŸru!') : 'DoÄŸru!') : (window.t ? t('quiz.wrong', 'YanlÄ±ÅŸ!') : 'YanlÄ±ÅŸ!');
        const statusColor = isCorrect ? 'var(--success)' : 'var(--danger)';
        
        explanationDiv.innerHTML = `
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                <span style="font-size: 1.2rem;">${statusIcon}</span>
                <strong style="color: ${statusColor}; font-size: 1.1rem;">${statusText}</strong>
            </div>
            <div style="display: flex; align-items: flex-start; gap: 8px; margin-top: 10px;">
                <span style="font-size: 1.2rem;">ğŸ’¡</span>
                <div>
                    <strong style="color: var(--info);">${window.t ? t('quiz.explanation', 'AÃ§Ä±klama') : 'AÃ§Ä±klama'}:</strong>
                    <p style="color: var(--text-secondary); line-height: 1.6; margin: 5px 0 0;">${Utils.sanitizeHTML(question.explanation)}</p>
                </div>
            </div>
        `;
        
        optionsList.appendChild(explanationDiv);
    },

    /**
     * ButonlarÄ± gÃ¼nceller - TAM HATASIZ
     */
    updateButtons() {
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');

        const isFirstQuestion = this.state.currentIndex === 0;
        const isLastQuestion = this.state.currentIndex === this.state.questions.length - 1;

        // Ã–NCEKÄ° BUTONU
        if (prevBtn) {
            prevBtn.disabled = isFirstQuestion;
            
            if (!isFirstQuestion || this.state.isReviewing) {
                prevBtn.style.display = 'inline-flex';
                prevBtn.style.opacity = isFirstQuestion ? '0.5' : '1';
            } else {
                prevBtn.style.display = 'none';
            }
        }

        // SONRAKÄ° BUTONU
        if (nextBtn) {
            if (this.state.isReviewing) {
                nextBtn.style.display = isLastQuestion ? 'none' : 'inline-flex';
                const nextText = window.t ? t('quiz.next', 'Sonraki') : 'Sonraki';
                nextBtn.innerHTML = `${nextText} â†’`;
            } else {
                nextBtn.style.display = isLastQuestion ? 'none' : 'inline-flex';
            }
        }
        
        // BÄ°TÄ°R BUTONU
        if (submitBtn) {
            submitBtn.style.display = isLastQuestion && !this.state.isReviewing ? 'inline-flex' : 'none';
        }

        // Exit butonunu gÃ¼ncelle
        this.showExitButton();
    },

    /**
     * Sonraki soruya geÃ§er
     */
    nextQuestion() {
        if (this.state.currentIndex < this.state.questions.length - 1) {
            this.state.currentIndex++;
            this.displayQuestion();
            this.saveState();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    },

    /**
     * Ã–nceki soruya gider
     */
    previousQuestion() {
        if (this.state.currentIndex > 0) {
            this.state.currentIndex--;
            this.displayQuestion();
            this.saveState();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    },

    /**
     * Testi bitirir
     */
    async finishQuiz() {
        try {
            const unanswered = this.state.answers.filter(a => a === null).length;
            
            if (unanswered > 0) {
                const confirmMsg = window.t 
                    ? t('quiz.unansweredConfirm', `${unanswered} soru cevaplanmadÄ±. Testi bitirmek istediÄŸinizden emin misiniz?`)
                    : `${unanswered} soru cevaplanmadÄ±. Testi bitirmek istediÄŸinizden emin misiniz?`;
                
                const confirmed = await Utils.confirm(confirmMsg);
                if (!confirmed) return;
            }

            this.stopTimer();
            const results = this.calculateResults();

            if (window.StorageManager) {
                StorageManager.saveTestResult(results);
                StorageManager.clearQuizState();
            }

            localStorage.removeItem('testify_generated_test');
            this.showResults(results);
            
        } catch (error) {
            console.error('Quiz bitirme hatasÄ±:', error);
            Utils.showToast('Test bitirilemedi', 'error');
        }
    },

    /**
     * SonuÃ§larÄ± hesaplar
     */
    calculateResults() {
        let correct = 0;
        let wrong = 0;

        this.state.questions.forEach((question, index) => {
            const userAnswer = this.state.answers[index];
            
            if (userAnswer !== null) {
                const selectedOption = question.o[userAnswer];
                if (selectedOption === question.a) {
                    correct++;
                } else {
                    wrong++;
                }
            }
        });

        const unanswered = this.state.questions.length - (correct + wrong);
        const successRate = this.state.questions.length > 0 
            ? Math.round((correct / this.state.questions.length) * 100) 
            : 0;

        return {
            mode: this.state.currentMode,
            totalQuestions: this.state.questions.length,
            correctAnswers: correct,
            wrongAnswers: wrong,
            unanswered: unanswered,
            successRate: successRate,
            time: this.state.elapsedSeconds,
            timestamp: Date.now(),
            testTitle: this.state.testTitle
        };
    },

    /**
     * SonuÃ§larÄ± gÃ¶sterir
     */
    showResults(results) {
        try {
            const quizPage = document.getElementById('quizPage');
            const resultsPage = document.getElementById('resultsPage');
            
            if (!quizPage || !resultsPage) {
                throw new Error('SonuÃ§ sayfasÄ± bulunamadÄ±');
            }

            quizPage.classList.remove('active');
            resultsPage.classList.add('active');

            const finalScore = document.getElementById('finalScore');
            const correctAnswers = document.getElementById('correctAnswers');
            const wrongAnswers = document.getElementById('wrongAnswers');
            const successPercent = document.getElementById('successPercent');
            const totalTimeResult = document.getElementById('totalTimeResult');

            if (finalScore) finalScore.textContent = `${results.correctAnswers}/${results.totalQuestions}`;
            if (correctAnswers) correctAnswers.textContent = results.correctAnswers;
            if (wrongAnswers) wrongAnswers.textContent = results.wrongAnswers;
            if (successPercent) successPercent.textContent = results.successRate + '%';
            if (totalTimeResult) totalTimeResult.textContent = Utils.formatTime(results.time);

            const resultsIcon = document.querySelector('.results-icon');
            if (resultsIcon) {
                if (results.successRate >= 90) resultsIcon.textContent = 'ğŸ†';
                else if (results.successRate >= 75) resultsIcon.textContent = 'ğŸ‰';
                else if (results.successRate >= 60) resultsIcon.textContent = 'ğŸ‘';
                else if (results.successRate >= 40) resultsIcon.textContent = 'ğŸ’ª';
                else resultsIcon.textContent = 'ğŸ“š';
            }

            window.scrollTo({ top: 0, behavior: 'smooth' });
        } catch (error) {
            console.error('SonuÃ§ gÃ¶sterme hatasÄ±:', error);
            Utils.showToast('SonuÃ§lar gÃ¶sterilemedi', 'error');
        }
    },

    /**
     * CevaplarÄ± inceler
     */
    reviewAnswers() {
        try {
            this.state.isReviewing = true;
            this.state.currentIndex = 0;

            const resultsPage = document.getElementById('resultsPage');
            const quizPage = document.getElementById('quizPage');
            
            if (!resultsPage || !quizPage) {
                throw new Error('Quiz sayfasÄ± bulunamadÄ±');
            }

            resultsPage.classList.remove('active');
            quizPage.classList.add('active');

            this.displayQuestion();

            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');

            if (prevBtn) prevBtn.style.display = 'inline-flex';
            if (nextBtn) nextBtn.style.display = 'inline-flex';
            if (submitBtn) submitBtn.style.display = 'none';

            this.showExitButton();

            const reviewMsg = window.t 
                ? t('quiz.reviewMode', 'Ä°nceleme modu - AÃ§Ä±klamalarÄ± okuyabilirsiniz')
                : 'Ä°nceleme modu - AÃ§Ä±klamalarÄ± okuyabilirsiniz';
            Utils.showToast(reviewMsg, 'info');
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        } catch (error) {
            console.error('Ä°nceleme modu hatasÄ±:', error);
            Utils.showToast('Ä°nceleme modu baÅŸlatÄ±lamadÄ±', 'error');
        }
    },

    /**
     * Yeni quiz baÅŸlatÄ±r
     */
    newQuiz() {
        try {
            this.cleanupPreviousQuiz(); // âœ… Temizlik
            
            const resultsPage = document.getElementById('resultsPage');
            const quizPage = document.getElementById('quizPage');
            const testSelection = document.getElementById('testSelection');
            
            if (resultsPage) resultsPage.classList.remove('active');
            if (quizPage) quizPage.classList.remove('active');
            if (testSelection) testSelection.classList.add('active');

            // State'i sÄ±fÄ±rla
            this.state = {
                currentMode: null,
                questions: [],
                currentIndex: 0,
                answers: [],
                startTime: null,
                timerInterval: null,
                elapsedSeconds: 0,
                isReviewing: false,
                testTitle: null,
                testDescription: null,
                eventListenersAttached: this.state.eventListenersAttached
            };

            localStorage.removeItem('testify_generated_test');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        } catch (error) {
            console.error('Yeni quiz baÅŸlatma hatasÄ±:', error);
            Utils.showToast('Yeni test baÅŸlatÄ±lamadÄ±', 'error');
        }
    },

    /**
     * Quiz'den Ã§Ä±kar
     */
    async exitQuiz() {
        if (this.state.isReviewing) {
            this.newQuiz();
            return;
        }

        const confirmMsg = window.t 
            ? t('quiz.exitConfirm', 'Testi bÄ±rakmak istediÄŸine emin misin?\n\nÄ°lerleme kaydedilmeyecek!')
            : 'Testi bÄ±rakmak istediÄŸine emin misin?\n\nÄ°lerleme kaydedilmeyecek!';
        
        const confirmed = await Utils.confirm(confirmMsg);
        if (!confirmed) return;

        try {
            const answeredCount = this.state.answers.filter(a => a !== null).length;
            const totalCount = this.state.questions.length;

            this.cleanupPreviousQuiz(); // âœ… Temizlik

            if (window.StorageManager) {
                StorageManager.clearQuizState();
            }

            const quizPage = document.getElementById('quizPage');
            const resultsPage = document.getElementById('resultsPage');
            const testSelection = document.getElementById('testSelection');
            
            if (quizPage) quizPage.classList.remove('active');
            if (resultsPage) resultsPage.classList.remove('active');
            if (testSelection) testSelection.classList.add('active');

            this.state = {
                currentMode: null,
                questions: [],
                currentIndex: 0,
                answers: [],
                startTime: null,
                timerInterval: null,
                elapsedSeconds: 0,
                isReviewing: false,
                testTitle: null,
                testDescription: null,
                eventListenersAttached: this.state.eventListenersAttached
            };

            if (answeredCount > 0) {
                Utils.showToast(
                    `ğŸ“‹ Test bÄ±rakÄ±ldÄ± (${answeredCount}/${totalCount} soru cevaplanmÄ±ÅŸtÄ±)`,
                    'info',
                    4000
                );
            } else {
                Utils.showToast('Test iptal edildi', 'info');
            }

            window.scrollTo({ top: 0, behavior: 'smooth' });

        } catch (error) {
            console.error('Quiz Ã§Ä±kÄ±ÅŸ hatasÄ±:', error);
            Utils.showToast('Ã‡Ä±kÄ±ÅŸ yapÄ±lamadÄ±', 'error');
        }
    },

    /**
     * âœ… YENÄ°: Event listener'larÄ± kur (sadece bir kez)
     */
    setupEventListeners() {
        if (this.state.eventListenersAttached) {
            console.log('âš ï¸ Event listener\'lar zaten ekli');
            return;
        }

        console.log('ğŸ”§ Quiz event listener\'lar kuruluyor...');
        
        // Test kartlarÄ±
        const testOptions = document.querySelector('.test-options');
        if (testOptions) {
            const modes = ['practice', 'exam', 'ai', 'custom'];
            const cards = testOptions.querySelectorAll('.test-option-card');
            
            cards.forEach((card, index) => {
                const mode = modes[index];
                
                card.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    this.startQuiz(mode);
                });
                
                card.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.startQuiz(mode);
                    }
                });
            });
        }

        // Navigation buttons
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        const reviewBtn = document.getElementById('reviewBtn');
        const newQuizBtn = document.getElementById('newQuizBtn');
        const exitQuizBtn = document.getElementById('exitQuizBtn');

        if (prevBtn) {
            prevBtn.addEventListener('click', (e) => {
                e.preventDefault();
                this.previousQuestion();
            });
        }

        if (nextBtn) {
            nextBtn.addEventListener('click', (e) => {
                e.preventDefault();
                this.nextQuestion();
            });
        }

        if (submitBtn) {
            submitBtn.addEventListener('click', (e) => {
                e.preventDefault();
                this.finishQuiz();
            });
        }

        if (reviewBtn) {
            reviewBtn.addEventListener('click', (e) => {
                e.preventDefault();
                this.reviewAnswers();
            });
        }

        if (newQuizBtn) {
            newQuizBtn.addEventListener('click', (e) => {
                e.preventDefault();
                this.newQuiz();
            });
        }

        if (exitQuizBtn) {
            exitQuizBtn.addEventListener('click', (e) => {
                e.preventDefault();
                this.exitQuiz();
            });
        }

        this.state.eventListenersAttached = true;
        console.log('âœ… Quiz event listener\'lar kuruldu');
    }
};

// âœ… Sadece bir kez event listener kur
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
        QuizManager.setupEventListeners();
    });
} else {
    QuizManager.setupEventListeners();
}

// âœ… Sayfa kapanÄ±rken temizlik yap
window.addEventListener('beforeunload', () => {
    QuizManager.stopTimer();
});

// Export
window.QuizManager = QuizManager;

/**
 * FLOATING TESTFY CHAT WIDGET
 */
const ChatWidget = {
    initialized: false,
    init() {
        if (this.initialized) return;
        this.initialized = true;

        const widget = document.getElementById('chatWidget');
        const toggleBtn = document.getElementById('chatToggleBtn');
        const closeBtn = document.getElementById('chatCloseBtn');
        const minimizeBtn = document.getElementById('chatMinimizeBtn');

        if (!widget || !toggleBtn) {
            console.warn('Chat widget Ã¶ÄŸeleri bulunamadÄ±');
            return;
        }

        const openWidget = () => {
            widget.classList.add('chat-widget--open');
            widget.classList.remove('chat-widget--minimized');
            widget.setAttribute('aria-hidden', 'false');
            toggleBtn.classList.add('chat-toggle-btn--hidden');

            const input = document.getElementById('aiInput');
            if (input) {
                setTimeout(() => input.focus(), 50);
            }
        };

        const closeWidget = () => {
            widget.classList.remove('chat-widget--open', 'chat-widget--minimized');
            widget.setAttribute('aria-hidden', 'true');
            toggleBtn.classList.remove('chat-toggle-btn--hidden');
        };

        const toggleMinimize = () => {
            if (!widget.classList.contains('chat-widget--open')) return;
            widget.classList.toggle('chat-widget--minimized');
        };

        toggleBtn.addEventListener('click', openWidget);
        if (closeBtn) closeBtn.addEventListener('click', closeWidget);
        if (minimizeBtn) minimizeBtn.addEventListener('click', toggleMinimize);

        // Escape ile kapat
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && widget.classList.contains('chat-widget--open')) {
                closeWidget();
            }
        });

        console.log('âœ… ChatWidget hazÄ±r');
    }
};

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
        ChatWidget.init();
    });
} else {
    ChatWidget.init();
}
    </script>
</body>
</html>
```
